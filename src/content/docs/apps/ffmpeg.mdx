---
title: 'ffmpeg'
description: 'Работа с программой ffmpeg. Примеры использования ffmpeg для обработки видео.'
---

import { ArchPkg, Repology } from '@components/packaging'

<figure class="pic">
    ![Логотип ffmpeg](./logos/ffmpeg.svg)
    <figcaption>Логотип ffmpeg</figcaption>
</figure>

---

`ffmpeg` &mdash; кроссплатформенный инструмент для обработки видео- и
аудиофайлов.

Установите пакет <ArchPkg pkg="ffmpeg" />:

```shell
sudo pacman -S ffmpeg
```

<Repology pkg="ffmpeg" />

На этой странице представлены примеры использования `ffmpeg` для пременения тех
или иных эффектов.

## Затухание/проявление (fade)

Как добавить эффект проявления или затухания с помощью `ffmpeg`.

:::note

Для всех команд ниже:

-   **Начало** &mdash; время начала затухания (в секундах от начала)
-   **Продолжительность** &mdash; продолжительность эффекта (в секундах)

:::

### Аудио

```shell title=Затухание
ffmpeg -i in.mp3 -af afade=t=out:st=<начало>:d=<продолжительность> out.mp3
```

```shell title=Проявление
ffmpeg -i in.mp3 -af afade=t=in:st=0:d=<продолжительность> out.mp3
```

### Видео

```shell title=Затухание
ffmpeg -i in.mp4 -vf fade=t=out:st=<начало>:d=<продолжительность> out.mp4
```

```shell title=Проявление
ffmpeg -i in.mp4 -vf fade=t=in:st=0:d=<продолжительность> out.mp4
```

### Комбинирование фильтров

Если нужно применить и проявление, и затухание, опции разделяются запятыми:

```shell
ffmpeg -i video.mp4 -vf "fade=t=in:st=0:d=10,fade=t=out:st=10:d=5" -c:a copy out.mp4
```

## Сжатие

Уменьшить размер видео можно командой:

```shell
ffmpeg -i in.mp4 -vcodec libx265 -crf 28 out.mp4
```

:::caution[Обратите внимание]

Если необходима совместимость с macOS (QuickTime), нужно сохранить кодек `H.265/HEVC`:

```shell
ffmpeg -i in.mp4 -c:v libx265 -preset fast -crf 28 -tag:v hvc1 -c:a eac3 -b:a 224k out.mp4
```

:::

## Создание видео-стикеров (Telegram)

Telegram позволяет создавать
[видео-стикеры](https://core.telegram.org/stickers/#video-stickers-and-emoji).
Файл видео-стикера должен удовлетворять следующим условиям:

- Формат `.webm`
- До 30 кадров в секунду
- Кодек VP9
- Отсутствие аудиопотока
- Одна сторона должна быть размером 512 пикселей, другая сторона меньше или
  равна 512 пикселей
- Продолжительность не должна превышать 3 секунд
- Размер видео после кодирования не должен превышать 256 КБ

Создать файл видео-стикера можно командой:

```sh
ffmpeg -y -i in.mov -r 30 -t 2.99 -an -c:v libvpx-vp9 \
    -pix_fmt yuva420p \
    -vf 'scale=512:512:force_original_aspect_ratio=decrease' \
    -b:v 400K \
    out.webm
```

При этом формат входного файла (`in.mov` в примере) может быть практически
любым: `ffmpeg` поддерживает большое количество форматов видео и изображений.

Если размер выходного файла больше 256 КБ, попробуйте уменьшить значение
параметра `-b:v 400K`, например, до `-b:v 300K`.

## См. также

-   [\[Stack Exchange\] How do I fade in and out in FFmpeg?](https://video.stackexchange.com/questions/28269/how-do-i-fade-in-and-out-in-ffmpeg)
-   [\[GitHub Gist\] `ffmpeg-compress.mp4`](https://gist.github.com/lukehedger/277d136f68b028e22bed)
-   [\[GitHub Gist\] Telegram - Create Video Sticker (.WEBM) with FFMPEG ](https://gist.github.com/xacnio/902a750d0858dd8dd468c3cd73166dc4)
