---
title: 'Конфигурация: Ввод'
sidebar:
    label: 'Ввод'
    order: 2
---

import { Badge } from '@astrojs/starlight/components'

## Обзор

В этом блоке вы можете настроить устройства ввода, такие как клавиатуры и мыши,
а также некоторые опции, связанные с вводом.

Для каждого типа устройства есть свой подблок:

-   `keyboard` (клавиатура)
-   `touchpad` (тачпад)
-   `mouse` (мышь)
-   `trackpoint` (трекпоинт, или тензометрический джойстик)
-   `tablet` (графический планшет)
-   `touch` (тачскрин, или сенсорный экран)

На данный момент нет возможности настраивать отдельные устройство
(но это есть в планах).

Все настройки в одном месте:

```kdl
input {
    keyboard {
        xkb {
            // layout "us"
            // variant "colemak_dh_ortho"
            // options "compose:ralt,ctrl:nocaps"
            // model ""
            // rules ""
        }

        // repeat-delay 600
        // repeat-rate 25
        // track-layout "global"
    }

    touchpad {
        // off
        tap
        // dwt
        // dwtp
        natural-scroll
        // accel-speed 0.2
        // accel-profile "flat"
        // scroll-method "two-finger"
        // tap-button-map "left-middle-right"
        // click-method "clickfinger"
        // left-handed
        // disabled-on-external-mouse
        // middle-emulation
    }

    mouse {
        // off
        // natural-scroll
        // accel-speed 0.2
        // accel-profile "flat"
        // scroll-method "no-scroll"
        // left-handed
        // middle-emulation
    }

    trackpoint {
        // off
        // natural-scroll
        // accel-speed 0.2
        // accel-profile "flat"
        // scroll-method "on-button-down"
        // middle-emulation
    }

    tablet {
        // off
        map-to-output "eDP-1"
        // left-handed
    }

    touch {
        map-to-output "eDP-1"
    }

    // disable-power-key-handling
    // warp-mouse-to-focus
    // focus-follows-mouse max-scroll-amount="0%"
    // workspace-auto-back-and-forth
}
```

## Клавиатура <Badge text="keyboard" type="note"/>

### Раскладка

В блоке `xkb` вы можете задать раскладку, вариант, модель и правила для клавиатуры.
Эти опции передаются напрямую в `libxkbcommon`, который также используется в
большинстве Wayland-композиторов.
См. [`xkeyboard-config(7)`](https://man.archlinux.org/man/xkeyboard-config.7)
для более подробной информации.

```kdl
input {
    keyboard {
        xkb {
            layout "us,ru"
            variant "colemak_dh_ortho"
            options "compose:ralt,ctrl:nocaps"
        }
    }
}
```

При использовании нескольких раскладок, niri может запоминать текущую раскладку
глобально (по умолчанию) или отдельно для окон. Вы можете настроить это с
помощью опции `track-layout`.

-   `global` &mdash; раскладка изменяется глобально для всех окон.
-   `window` &mdash; раскладка отслеживается независимо для каждого окна.

```kdl
input {
    keyboard {
        track-layout "global"
    }
}
```

### Повторение

-   Задержка (`repeat-delay`) &mdash; промежуток до того, как начнётся повторение (в мс).
-   Скорость (`repeat-rate`) &mdash; как часто считывается повторение (в символах в секунду).

```kdl
input {
    keyboard {
        repeat-delay 600
        repeat-rate 25
    }
}
```

## Устройства-указатели

<Badge text="mouse" type="note"/>
<Badge text="tablet" type="note"/>
<Badge text="touch" type="note"/>
<Badge text="touchpad" type="note"/>
<Badge text="trackpoint" type="note"/>

Большинство настроек для устройств наведения передаются непосредственно в
`libinput`. Другие Wayland-композиторы также используют `libinput`, поэтому,
скорее всего, вы найдете там те же настройки. Флаги, как `tap`, вы можете
опустить или закомментировать, чтобы отключить настройку.

Некоторые настройки общие для всех устройств-указателей:

-   `off` &mdash; если опция включена, никакие события не будут отправляться с устройства.

Некоторые настройки общие для `touch`, `mouse` и `trackpoint`:

-   `natural-scroll` &mdash; если опция включена, инвертирует направление прокрутки.
-   `accel-speed` &mdash; скорость ускорения указателя, валидными значениями
    являются числа с плавающей точкой от `-1.0` до `1.0`, `0.0` по умолчанию.
-   `accel-profile` &mdash; может быть либо `adaptive` (по умолчанию),
    либо `flat` (выключает ускорение указателя).
-   `scroll-method` &mdash; когда генерировать событие прокрутки вместо движения
    указателя. Может быть одним из: `no-scroll`, `two-finger`, `edge`, `on-button-down`.
    Значение по умолчанию и поддерживаемые значения вариируются в зависимости от типа
    устройства.
-   `middle-emulation` &mdash; эмулировать нажатие средней кнопки мыши (колёсика)
    одновременным нажатием левой и правой кнопки мыши.

Настройки, специфичные для `touchpad`, `mouse` и `tablet`:

-   `left-handed` &mdash; включает леворукий режим.

Настройки, специфичные для `touchpad`'ов:

-   `tap` &mdash; клик по касанию.
-   `dwt` &mdash; (disable-when-typing) отключает тачпад при печати.
-   `dwtp` &mdash; (disable-when-trackpointing) отключает тачпад при использовании
    трекпоинта.
-   `tap-button-map` &mdash; либо `left-right-middle`, либо `left-middle-right`;
    контролирует, какие кнопки отвечают за двойное и тройное нажатие.
-   `click-method` &mdash; либо `button-areas`, либо `clickfinger`, изменяет
    [метод нажатия](https://wayland.freedesktop.org/libinput/doc/latest/clickpad-softbuttons.html).
-   `disabled-on-external-mouse` &mdash; отключить тачпад при наличии внешнего
    указателя (например, мыши).

Графические планшеты и сенсорные экраны &mdash; это абсолютные устройства-указатели,
они могут быть привязаны с определённым устройством вывода следующим образом:

```kdl
input {
    tablet {
        map-to-output "eDP-1"
    }

    touch {
        map-to-output "eDP-1"
    }
}
```

Имена устройств вывода совпадают с [конфигурацией вывода](/niri/configuration/output).

<Badge text="С версии 0.1.7" variant="tip" size="small"/> Если графический планшет не
привязан ни к одному устройству вывода, он привязывается к объединению всех устройств
вывода, без исправления соотношения сторон.

## Общие настройки

Следующие настройки не являются специфичными для отдельных видов устройств ввода.

### `disable-power-key-handling`

По умолчанию, niri переопределит поведение кнопки питания, чтобы при нажатии
переходить в режим сна (вместо выключения). Установите этот флаг, чтобы задать
поведение этой кнопки где-либо ещё (например, в файле `logind.conf`):

```kdl
input {
    disable-power-key-handling
}
```

### `warp-mouse-to-focus`

Заставляет указатель переместиться на сфокусированное окно.

Координаты X и Y рассчитываются отдельно, т.е. если только горизонтального
перемещения достаточно, чтобы поместить мышь в сфокусированное окно, указатель
будет перемещён только по горизонтали.

```
input {
    warp-mouse-to-focus
}
```

### `focus-follows-mouse`

Автоматически переключаться на окно или вывод при перемещении на него указателя.

```
input {
    focus-follows-mouse
}
```

<Badge text="С версии 0.1.8" variant="tip" size="small"/> Опционально, вы можете
установить опцию `max-scroll-amount`. В таком случае, опция `focus-follows-mouse`
не будет фокусироваться на окне, если это приведёт к прокрутке на промежуток,
больше заданного. Значение является процентом от ширины рабочей зоны:

```kdl
input {
    // Разрешает смену фокуса, если она приведёт к прокрутке,
    // не превышающей 10%.
    focus-follows-mouse max-scroll-amount="10%"
}
```

```kdl
input {
    // Разрешает смену фокуса, если она не приведёт к прокрутке
    // рабочей области.
    focus-follows-mouse max-scroll-amount="0%"
}
```

### `workspace-auto-back-and-forth`

Обычно, при переключении на уже активное рабочее пространство не даст никакого
эффекта. Если этот флаг включен, переключение на ту же рабочее пространство
вернёт вас на предыдущее активное пространство.

Niri корректно переключится на рабочее пространство, из которого вы
переключились в первый раз, даже если за это время рабочие пространства были
переупорядочены.

```kdl
input {
    workspace-auto-back-and-forth
}
```
