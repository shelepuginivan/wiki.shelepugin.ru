---
title: 'Конфигурация: Комбинации клавиш'
sidebar:
    label: 'Комбинации клавиш'
    order: 4
---

import { Badge } from '@astrojs/starlight/components'

## Обзор

В блоке `binds {}` задаются комбинации клавиш.

:::note

Этот блок **НЕ** заполняется значениями по умолчанию в случае, если он пропущен,
поэтому убедитесь, что он скопирован из конфигурации по умолчанию.

:::

Каждая комбинация клавиш &mdash; это горячая клавиша,
за которой следует одно действие, заключённое в фигурные скобки `{}`:

```kdl
binds {
    Mod+Left { focus-column-left; }
    Super+Alt+L { spawn "swaylock"; }
}
```

Горячие клавиши представляют собой модификаторы, разделённые знаком плюс `+`,
за которыми следует XKB-имя клавиши.

Валидными модификаторами являются:

-   `Ctrl` или `Control`
-   `Shift`
-   `Alt`
-   `Super` или `Win`
-   `ISO_Level3_Shift` или `Mod5` &mdash; на некоторых раскладках, это клавиша <kbd>AltGr</kbd>
-   `Mod`

`Mod` &mdash; это особенный модификатор, который приравнивается к `Super`,
если niri запущен из TTY, или к `Alt`, если композитор запущен внутри окна.
Таким образом, вы можете протестировать niri в оконном режиме, не вызывая
слишком много конфликтов с комбинациями клавишами корневого композитора.
Именно поэтому большинство комбинаций клавиш по умолчанию используют
модификатор `Mod`.

:::tip

Чтобы узнать XKB-имя той или иной клавиши, вы можете использовать программу
наподобие [`wev`](https://git.sr.ht/~sircmpwn/wev).

Запустите её из терминала и нажмите клавишу, имя которой вам нужно узнать.
Вы увидете вывод по типу:

```txt "sym: Left" "sym: Right"
[14:     wl_keyboard] key: serial: 757775; time: 44940343; key: 113; state: 1 (pressed)
                      sym: Left         (65361), utf8: ''
[14:     wl_keyboard] key: serial: 757776; time: 44940432; key: 113; state: 0 (released)
                      sym: Left         (65361), utf8: ''
[14:     wl_keyboard] key: serial: 757777; time: 44940753; key: 114; state: 1 (pressed)
                      sym: Right        (65363), utf8: ''
[14:     wl_keyboard] key: serial: 757778; time: 44940846; key: 114; state: 0 (released)
                      sym: Right        (65363), utf8: ''
```

Обратите внимание на `sym: Left` и `sym: Right` &mdash; это и есть названия
клавиш. В этом примере я нажимал на стрелки влево и вправо.

:::

<Badge text="С версии 0.1.8" variant="tip"/> По умолчанию, комбинации клавиш
повторяются (т.е. удерживание будет вызывать повторяющееся действие). Вы можете
отключить это поведение для отдельных комбинаций с помощью `repeat=false`:

```kdl "repeat=false"
binds {
    Mod+T repeat=false { spawn "alacritty"; }
}
```

Комбинация также может иметь время перезарядки, которое ограничит скорость
вызова и предотвратит слишком быстрое повторное срабатывание.

```kdl "cooldown-ms=500"
binds {
    Mod+T cooldown-ms=500 { spawn "alacritty"; }
}
```

Наиболее полезно это для привязок прокрутки.

## Привязки прокрутки

Вы можете привязать тики прокрутки колёсика мыши используя следующий синтаксис.
Эти привязки меняют направление в зависимости от настройки `natural-scroll`.

```kdl
binds {
    Mod+WheelScrollDown cooldown-ms=150 { focus-workspace-down; }
    Mod+WheelScrollUp   cooldown-ms=150 { focus-workspace-up; }
    Mod+WheelScrollRight                { focus-column-right; }
    Mod+WheelScrollLeft                 { focus-column-left; }
}
```

Аналогично, вы можете привязать прокрутку на тачпаде. Так как его прокрутка
непрерывна, niri разделит её на интервалы в зависимости от прокрученного
расстояния.

Эти привязки также испытывают влияние настройки `natural-scroll`, так что
следующие привязки инвертированы, так как по умолчанию niri включает
`natural-scroll` для тачпадов:

```kdl
binds {
    Mod+TouchpadScrollDown { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.02+"; }
    Mod+TouchpadScrollUp   { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.02-"; }
}
```

Когда модификатор зажат, прокрутка как колёсика мыши, так и тачпада
предотвратит получение событий прокрутки приложениями. Например, если в вашей
конфигурации есть привязка к `Mod+WheelScrollDown`, то при зажатии
<kbd>Mod</kbd>, все события прокрутки колёсика мыши будут обрабатываться только
niri.

## Действия

Каждое действие, которое вы можете привязать к комбинации клавиш, также доступно
программно через `niri msg action`. Запустите

```shell
niri msg action --help
```

чтобы вывести список всех доступных действий и их описания.

Ниже приведены несколько примеров, требующие более подробного объяснения.

### `spawn`

Запускает программу.

`spawn` принимает путь до исполняемого файла первым аргументом, за которым
следуют аргументы программы. Например:

```kdl
binds {
    // Запустить alacritty.
    Mod+T { spawn "alacritty"; }

    // Запустить `wpctl set-volume @DEFAULT_AUDIO_SINK@ 0.1+`.
    XF86AudioRaiseVolume { spawn "wpctl" "set-volume" "@DEFAULT_AUDIO_SINK@" "0.1+"; }
}
```

:::tip

<Badge text="С версии 0.1.5" variant="tip"/>

Привязки к запуску имеют особое свойство `allow-when-locked=true`, которое
позволяет использовать их даже тогда, когда сессия заблокирована:

```kdl "allow-when-locked=true"
binds {
    // Эта связка для переключения звука будет работать даже
    // при заблокированной сессии.
    XF86AudioMute allow-when-locked=true { spawn "wpctl" "set-mute" "@DEFAULT_AUDIO_SINK@" "toggle"; }
}
```

:::

На данный момент, niri **НЕ** использует оболочку для запуска команд, т.е. вам
нужно вручную разделять аргументы.

```kdl
binds {
    // Верно: все аргументы переданы отдельно.
    Mod+T { spawn "alacritty" "-e" "/usr/bin/fish"; }

    // Неверно: вся строка `alacritty -e /usr/bin/fish` будет считана как путь
    // до исполняемого файла.
    Mod+D { spawn "alacritty -e /usr/bin/fish"; }

    // Неверно: передаст `-e /usr/bin/fish` как один аргумент, что не будет
    // распознано alacritty.
    Mod+Q { spawn "alacritty" "-e /usr/bin/fish"; }
}
```

Это также означает, что вы не можете использовать переменные окружения или `~`.
Если это необходимо, вы можете вручную запустить команду через оболочку:

```kdl
binds {
    // Неверно: все строки будут переданы программе напрямую.
    Mod+T { spawn "grim" "-o" "$MAIN_OUTPUT" "~/screenshot.png"; }

    // Верно: ручной запуск через оболочку позволяет расширять аргументы.
    // Обратите внимание, что вся команда передана в одном аргументе,
    // потому что оболочка исполнит команду, самостоятельно разделив аргументы
    // по пробелам.
    Mod+D { spawn "sh" "-c" "grim -o $MAIN_OUTPUT ~/screenshot.png"; }

    // Вы также можете использовать пайпы, множество команд, 
    // подстановки процессов и тому подобное.
    Mod+Q { spawn "sh" "-c" "notify-send clipboard \"$(wl-paste)\""; }
}
```

Исключением является то, что niri заменит тильду `~` на путь до домашней
директории _тогда и только тогда, когда_ она стоит вначале пути до исполняемого
файла.

```kdl
binds {
    // Это сработает: ~ вначале заменяется на путь до домашней директории.
    Mod+T { spawn "~/scripts/do-something.sh"; }
}
```

### `quit`

Выйти из niri, предварительно показав диалог подтверждения, чтобы предотвратить
случайные срабатывания.

```kdl
binds {
    Mod+Shift+E { quit; }
}
```

Если вы хотите пропустить диалог и выйти сразу, используйте флаг `skip-confirmation=true`:

```kdl "skip-confirmation=true"
binds {
    Mod+Shift+E { quit skip-confirmation=true; }
}
```

### `do-screen-transition` <Badge text="С версии 0.1.6" variant="tip"/>

Заморозить экран на короткий промежуток времени, а затем плавно переключиться
на новое содержимое.

```kdl
binds {
    Mod+Return { do-screen-transition; }
}
```

Это действие используется, по большей части, для запуска скриптов, которые
меняют тему или стиль системы (например, между светлой и тёмной темами). Это
создаёт эффект перехода, который выглядит плавно и синхронно.

Например, можно использовать это для смены цветовой схемы GNOME:

```shell
niri msg action do-screen-transition
dconf write /org/gnome/desktop/interface/color-scheme '"prefer-dark"'
```

По умолчанию, экран замораживается на 250 мс, чтобы дать окнам время на
перерисовку перед переходом. Но вы можете задать другую длительность следующим
образом:

```kdl "delay-ms=100"
binds {
    Mod+Return { do-screen-transition delay-ms=100; }
}
```

Или так, в скриптах:

```shell "--delay-ms 100"
niri msg action do-screen-transition --delay-ms 100
```
