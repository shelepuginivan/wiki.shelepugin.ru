---
title: 'Восстановление GRUB'
description: 'Как восстановить загрузчик GRUB из recovery mode или rescue mode'
---

import { Badge, Steps } from '@astrojs/starlight/components';

[**GRUB**](https://wiki.archlinux.org/title/GRUB) &mdash; популярный загрузчик (boot loader), который используется во многих дистрибутивах Linux.

Если при использовании GRUB не получилось загрузить систему, возможны несколько сценариев. Определить эти сценарии можно по виду командной строки (промпта):

1.  ```
    grub>
    ```

    Этот промпт указывает на то, что GRUB определил всё, кроме файла
    конфигурации (`/boot/grub/grub.cfg` по умолчанию). См. [`grub>`](#grub).

2.  ```
    grub rescue>
    ```

    Этот промпт указывает на то, что GRUB не смог определить "свою" директорию
    или файлы в ней повреждены/отсутствуют. См. [`grub rescue>`](#grub-rescue).


## `grub>`

<Steps>


1.  **Выведите список разделов**

    ```shell
    ls
    ```

    Будет отображён список всех блочных устройств, которые GRUB смог определить.

2.  **Определите корневой раздел**

    Для этого необходимо выполнить команду ниже для каждого раздела
    из шага 1 (замените `_` на номер в вашем случае):

    ```shell /_/
    ls (hd_)/    # "/" в конце является обязательным!
    ```

    Если вывод будет содержать директории `boot`, `usr` и т. д. &mdash; это
    корневой раздел.

    Наконец, нужно отметить этот раздел как корневой для GRUB (замените `_` на
    номер в вашем случае):

    ```shell /_/
    set root=(hd_)
    ```

3.  **Задайте ядро Linux, которое будет использоваться для загрузки**

    ```shell
    linux /boot/vmlinuz-linux root=/dev/sda1
    ```

    Ядро и корневой раздел нужно выбрать в зависимости от системы. В качестве `root` нужно установить корневой раздел.

    Ещё один пример. В данном случае используется SSD, а не жёсткий диск:

    ```shell
    linux /boot/vmlinuz-linux root=/dev/nvme0n1p3
    ```

4.  **Загрузите initramfs**

    ```shell
    initrd /boot/initramfs-linux.img
    ```

    Обратите внимаение, что название файла, как правило, имеет вид
    `initramfs-<linux>.img`, где `<linux>` зависит от того, какое ядро
    используется в шаге 3.

    Например, если используется `/boot/vmlinuz-linux-zen`, нужно выполнить команду:

    ```shell /initramfs-linux-zen\.img/
    initrd /boot/initramfs-linux-zen.img
    ```

5.  **Загрузить систему**

    ```shell
    boot
    ```

    Для этого также можно нажать сочетание клавиш <kbd>Ctrl</kbd><kbd>X</kbd>
    или <kbd>F10</kbd>.

6.  **Переустановить GRUB**

    Для систем с BIOS (как правило, более старые устройства). Замените `X` на
    букву, которая используется в вашем случае:

    ```shell /X/
    grub-mkconfig -o /boot/grub/grub.cfg
    grub-install --target=i386-pc /dev/sdX
    ```

    Например:

    ```shell
    grub-mkconfig -o /boot/grub/grub.cfg
    grub-install --target=i386-pc /dev/sda
    ```

    Для систем с UEFI (как правила, более новые устройства):

    ```shell
    grub-mkconfig -o /boot/grub/grub.cfg
    grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB
    ```

    После названия блочного устройства не должно идти номера раздела! `grub-install` применяется не к разделу, а ко всему диску:
    - `/dev/sda` <Badge variant="success" text="Верно"/>
    - `/dev/sda1` <Badge variant="danger" text="Неверно"/>

7.  **Перезагрузите систему**

    ```shell
    reboot
    ```

</Steps>

## `grub rescue>`

В этом случае будем использовать загрузочную флешку (`livecd`). Хотя в редких
случаях можно восстановить систему и без неё, проще сделать это при помощи
`livecd`. В инструкции будет использоваться [загрузочный образ Arch
Linux](https://archlinux.org/download/), также известный как `archiso`. Можно
также использовать загрузочные образы других дистрибутивов.

<Steps>

1.  **Зайдите в BIOS/UEFI и измените порядок загрузки так, чтобы загрузочная
    флешка имела наивысший приоритет**

    Этот шаг сильно зависит от устройства, так что дать конкретные инструкции
    невозможно.

2.  **Примонтируйте необходимые разделы**

    Здесь вновь многое зависит от вашего устройства, поэтому приведу несколько
    примеров:

    ```shell
    mount /dev/sda1 /boot/efi
    mount /dev/sda2 /
    ```

    Если используется SSD:

    ```shell
    mount /dev/nvme0n1p1 /mnt/boot/efi
    mount /dev/nvme0n1p3 /mnt
    ```

3.  **Смените корень (`chroot`)**

    ```shell
    arch-chroot /mnt
    ```

4.  **Переустановите GRUB**
    
    Для систем с BIOS (как правило, более старые устройства). Замените `X` на
    букву, которая используется в вашем случае:

    ```shell /X/
    grub-mkconfig -o /boot/grub/grub.cfg
    grub-install --target=i386-pc /dev/sdX
    ```

    Например:

    ```shell
    grub-mkconfig -o /boot/grub/grub.cfg
    grub-install --target=i386-pc /dev/sda
    ```

    Для систем с UEFI (как правила, более новые устройства):

    ```shell
    grub-mkconfig -o /boot/grub/grub.cfg
    grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=GRUB
    ```

    После названия блочного устройства не должно идти номера раздела! `grub-install` применяется не к разделу, а ко всему диску:
    - `/dev/sda` <Badge variant="success" text="Верно"/>
    - `/dev/sda1` <Badge variant="danger" text="Неверно"/>

5.  **Перезагрузите систему**

    ```shell
    exit    # Или Ctrl+D, выход из arch-chroot
    reboot
    ```

    Не забудьте отсоединить загрузочный носитель!

</Steps>
